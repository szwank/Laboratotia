<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">xHat</span>, <span class="var type1" id="S3T2U4">P</span>] = fcn(<span class="var type1" id="S4T3U7">t</span>, <span class="var type1" id="S5T3U8">u1</span>, <span class="var type1" id="S6T3U9">u2</span>, <span class="var type1" id="S7T4U10">y</span> , <span class="var type1" id="S8T3U11">xHat1</span>, <span class="var type1" id="S9T3U12">Pk</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="mxinfo " id="T2:U9"><span class="var type1" id="S10T2U15">Ad</span> = <span class="mxinfo " id="T2:U11">[1 0 0.01 0; 0 1 0 0.01; 0 0 1 0; 0 0 0 1]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo " id="T5:U12"><span class="var type1" id="S11T5U39">Bd</span> = <span class="mxinfo " id="T5:U14">[0.0001 0;0 0.0001;0.01 0;0 0.01]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo " id="T6:U15"><span class="var type1" id="S12T6U55">Cd</span> = <span class="mxinfo " id="T6:U17">[1 0 0 0; 0 1 0 0]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo " id="T2:U18"><span class="var type1" id="S13T2U69">G</span> = <span class="mxinfo " id="T2:U20">zeros(<span class="mxinfo " id="T3:U21">4</span>,<span class="mxinfo " id="T3:U22">4</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo " id="T2:U23"><span class="var type1" id="S15T2U76">Z</span> = <span class="mxinfo " id="T2:U25">zeros(<span class="mxinfo " id="T3:U26">4</span>,<span class="mxinfo " id="T3:U27">4</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T7:U28"><span class="var type1" id="S16T7U83">V</span> = <span class="mxinfo " id="T7:U30">zeros(<span class="mxinfo " id="T3:U31">2</span>,<span class="mxinfo " id="T3:U32">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo " id="T3:U33"><span class="var type1" id="S17T3U90">xHat_k1</span>= <span class="var type1" id="S8T3U91">xHat1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo " id="T4:U36"><span class="var type1" id="S18T4U94">u</span> = <span class="mxinfo " id="T4:U38">[<span class="var type1" id="S5T3U97">u1</span>;<span class="var type1" id="S6T3U99">u2</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T8:U41"><span class="var type1" id="S4T3U103">t</span> == <span class="mxinfo " id="T3:U43">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line">  <span class="mxinfo " id="T1:U44"><span class="var type1" id="S19T1U107">x</span> = <span class="mxinfo " id="T1:U46">[pi/2; 0; 0; 0;]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line">    <span class="mxinfo " id="T2:U47"><span class="var type1" id="S21T2U122">Pk0</span> = <span class="mxinfo " id="T2:U49"><span class="var type1" id="S19T1U124">x</span> * <span class="var type1" id="S19T1U126">x</span>'</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line">    <span class="mxinfo " id="T1:U52"><span class="var type1" id="S22T1U129">xHat_kk1</span> = <span class="mxinfo " id="T1:U54"><span class="mxinfo " id="T1:U55"><span class="var type1" id="S10T2U132">Ad</span> * <span class="var type1" id="S19T1U133">x</span></span> + <span class="mxinfo " id="T1:U58"><span class="var type1" id="S11T5U135">Bd</span> * <span class="var type1" id="S18T4U136">u</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line">    <span class="mxinfo " id="T2:U61"><span class="var type1" id="S23T2U139">P_kk1</span> = <span class="mxinfo " id="T2:U63"><span class="var type1" id="S10T2U143">Ad</span> * <span class="var type1" id="S21T2U144">Pk0</span> * <span class="var type1" id="S10T2U146">Ad</span>' + <span class="var type1" id="S13T2U149">G</span> * <span class="var type1" id="S15T2U150">Z</span> * <span class="var type1" id="S13T2U152">G</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line">    <span class="mxinfo " id="T5:U70"><span class="var type1" id="S24T5U155">K</span> = <span class="mxinfo " id="T5:U72"><span class="mxinfo " id="T5:U73"><span class="var type1" id="S23T2U158">P_kk1</span> * <span class="var type1" id="S12T6U160">Cd</span>'</span> * <span class="mxinfo " id="T7:U76">inv(<span class="mxinfo " id="T7:U77"><span class="var type1" id="S12T6U166">Cd</span> * <span class="var type1" id="S23T2U167">P_kk1</span> * <span class="var type1" id="S12T6U169">Cd</span>' + <span class="var type1" id="S16T7U170">V</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo " id="T2:U82"><span class="var type1" id="S3T2U173">P</span> = <span class="mxinfo " id="T2:U84"><span class="mxinfo " id="T2:U85"><span class="mxinfo " id="T2:U86">(<span class="mxinfo " id="T2:U87"><span class="mxinfo " id="T2:U88">eye(4)</span> - <span class="mxinfo " id="T2:U89"><span class="var type1" id="S24T5U183">K</span> * <span class="var type1" id="S12T6U184">Cd</span></span></span>) * <span class="var type1" id="S23T2U185">P_kk1</span></span> * <span class="mxinfo " id="T2:U93">(<span class="mxinfo " id="T2:U94"><span class="mxinfo " id="T2:U95">eye(4)</span> - <span class="mxinfo " id="T2:U96"><span class="var type1" id="S24T5U193">K</span> * <span class="var type1" id="S12T6U194">Cd</span></span></span>)'</span></span> + <span class="mxinfo " id="T2:U99"><span class="mxinfo " id="T5:U100"><span class="var type1" id="S24T5U197">K</span> * <span class="var type1" id="S16T7U198">V</span></span> * <span class="mxinfo " id="T6:U103"><span class="var type1" id="S24T5U200">K</span>'</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T8:U105"><span class="var type1" id="S4T3U204">t</span> &gt; <span class="mxinfo " id="T3:U107">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line">    <span class="var type0" id="S22T0U208">xHat_kk1</span> = <span class="message error" id="M1F1C"><span class="mxinfo " id="T2:U108"><span class="var type1" id="S10T2U211">Ad</span> * <span class="var type1" id="S17T3U212">xHat_k1</span></span> + <span class="mxinfo " id="T1:U111"><span class="var type1" id="S11T5U214">Bd</span> * <span class="var type1" id="S18T4U215">u</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line">    <span class="mxinfo " id="T2:U114"><span class="var type1" id="S23T2U218">P_kk1</span> = <span class="mxinfo " id="T2:U116"><span class="mxinfo " id="T2:U117"><span class="mxinfo " id="T2:U118"><span class="mxinfo " id="T2:U119"><span class="mxinfo " id="T2:U120"><span class="var type1" id="S10T2U224">Ad</span> * <span class="var type1" id="S9T3U225">Pk</span></span> * <span class="mxinfo " id="T2:U123"><span class="var type1" id="S10T2U227">Ad</span>'</span></span> * <span class="var type1" id="S13T2U228">G</span></span> * <span class="var type1" id="S15T2U229">Z</span></span> * <span class="mxinfo " id="T2:U127"><span class="var type1" id="S13T2U231">G</span>'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line">    <span class="mxinfo " id="T5:U129"><span class="var type1" id="S24T5U234">K</span> = <span class="mxinfo " id="T5:U131"><span class="mxinfo " id="T5:U132"><span class="var type1" id="S23T2U237">P_kk1</span> * <span class="mxinfo " id="T5:U134"><span class="var type1" id="S12T6U239">Cd</span>'</span></span> * <span class="mxinfo " id="T7:U136">inv(<span class="mxinfo " id="T7:U137"><span class="mxinfo " id="T7:U138"><span class="mxinfo " id="T6:U139"><span class="var type1" id="S12T6U245">Cd</span> * <span class="var type1" id="S23T2U246">P_kk1</span></span> * <span class="mxinfo " id="T5:U142"><span class="var type1" id="S12T6U248">Cd</span>'</span></span> + <span class="var type1" id="S16T7U249">V</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line">    <span class="mxinfo " id="T2:U145"><span class="var type1" id="S3T2U252">P</span> = <span class="mxinfo " id="T2:U147"><span class="mxinfo " id="T2:U148"><span class="mxinfo " id="T2:U149">(<span class="mxinfo " id="T2:U150"><span class="mxinfo " id="T2:U151">eye(4)</span> - <span class="mxinfo " id="T2:U152"><span class="var type1" id="S24T5U262">K</span> * <span class="var type1" id="S12T6U263">Cd</span></span></span>) * <span class="var type1" id="S23T2U264">P_kk1</span></span> * <span class="mxinfo " id="T2:U156">(<span class="mxinfo " id="T2:U157"><span class="mxinfo " id="T2:U158">eye(4)</span> - <span class="mxinfo " id="T2:U159"><span class="var type1" id="S24T5U272">K</span> * <span class="var type1" id="S12T6U273">Cd</span></span></span>)'</span></span> + <span class="mxinfo " id="T2:U162"><span class="mxinfo " id="T5:U163"><span class="var type1" id="S24T5U276">K</span> * <span class="var type1" id="S16T7U277">V</span></span> * <span class="mxinfo " id="T6:U166"><span class="var type1" id="S24T5U279">K</span>'</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">    <span class="mxinfo " id="T1:U168"><span class="var type1" id="S2T1U282">xHat</span> = <span class="mxinfo " id="T1:U170"><span class="var type1" id="S22T1U284">xHat_kk1</span> + <span class="mxinfo " id="T1:U172"><span class="var type1" id="S24T5U286">K</span> * <span class="mxinfo " id="T4:U174">[<span class="var type1" id="S7T4U290">y</span> - <span class="mxinfo " id="T4:U176"><span class="var type1" id="S12T6U292">Cd</span> * <span class="var type1" id="S22T1U293">xHat_kk1</span></span>]</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line"></span></span>
</pre>
